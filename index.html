<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸´æ—¶è°·æ­Œé‚®ç®± - å…è´¹æ”¶ä¿¡</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body {
      font-family: "PingFang SC", "Microsoft Yahei", sans-serif;
      background-color: #e9ecf3;
    }
    .btn-side {
      @apply w-full py-3 text-white text-sm font-semibold rounded hover:opacity-90 transition;
    }
    .table-header {
      @apply px-4 py-2 text-sm font-semibold text-gray-600 border-b bg-gray-50;
    }
    .table-cell {
      @apply px-4 py-2 text-sm text-gray-800 border-b;
    }
  </style>
</head>
<body>
  <!-- é¡¶éƒ¨æ  -->
  <div class="bg-gray-800 text-white px-4 py-3 flex justify-between items-center">
    <div class="flex items-center space-x-2 text-lg font-bold">
      <img src="https://www.linshiguge.com/logo.png" alt="logo" class="w-6 h-6" />
      <span>ä¸´æ—¶è°·æ­Œ</span>
    </div>
    <div class="flex items-center space-x-2 text-sm">
      <input id="email" value="temp001@gmail.com" readonly class="bg-white text-gray-900 px-2 py-1 rounded text-sm font-mono w-60" />
      <select class="px-2 py-1 rounded text-gray-700 bg-white border" disabled>
        <option selected>æ›´æ¢gmail</option>
      </select>
    </div>
  </div>

  <!-- ä¸»ä½“å¸ƒå±€ -->
  <div class="flex min-h-[calc(100vh-56px)]">

    <!-- å·¦ä¾§ä¾§è¾¹æ  -->
    <div class="bg-[#e3e9f1] w-48 p-4 space-y-4">
      <button onclick="copyEmail()" class="btn-side bg-cyan-500">ğŸ“‹ å¤åˆ¶</button>
      <button onclick="fetchInbox()" class="btn-side bg-cyan-600">ğŸ”„ åˆ·æ–°</button>
      <button onclick="generateEmail()" class="btn-side bg-cyan-700">ğŸ² æ–°é‚®ç®±</button>
    </div>

    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <div class="flex-1 bg-white p-6">
      <!-- è‡ªåŠ¨åˆ·æ–°æç¤º -->
      <div class="mb-3 text-gray-500 text-sm" id="refresh-timer">æ­£åœ¨æ¥æ”¶é‚®ä»¶ä¸­... 5 ç§’åè‡ªåŠ¨åˆ·æ–°</div>

      <!-- è¡¨æ ¼ -->
      <div class="border rounded overflow-hidden">
        <div class="grid grid-cols-3 bg-gray-100 text-left">
          <div class="table-header">å‘ä»¶äºº</div>
          <div class="table-header">ä¸»é¢˜</div>
          <div class="table-header">æ—¶é—´</div>
        </div>
        <div id="email-list">
          <!-- é‚®ä»¶å°†è¢«åŠ¨æ€æ’å…¥ -->
        </div>
      </div>
    </div>
  </div>

  <!-- é¡µè„š -->
  <div class="text-center text-xs text-gray-400 py-4 bg-gray-100">
    è°·æ­Œä¸´æ—¶é‚®ç®± - æä¾›å…è´¹çš„ä¸´æ—¶è°·æ­Œé‚®ç®±ã€ä¸´æ—¶gmailé‚®ç®±ã€è°·æ­Œé‚®ç®±ä¸´æ—¶æ¥æ”¶æœåŠ¡
  </div>

  <script>
    const emailInput = document.getElementById("email");
    const list = document.getElementById("email-list");
    const timerText = document.getElementById("refresh-timer");
    let currentEmail = "temp001@gmail.com";
    let countdown = 5;

    function copyEmail() {
      navigator.clipboard.writeText(currentEmail);
      alert("é‚®ç®±åœ°å€å·²å¤åˆ¶ï¼š" + currentEmail);
    }

    function generateEmail() {
      const name = Math.random().toString(36).substring(2, 10);
      currentEmail = name + "@gmail.com";
      emailInput.value = currentEmail;
    }

    function formatTime(iso) {
      const date = new Date(iso);
      return date.toLocaleString();
    }

    async function fetchInbox() {
      try {
        const res = await fetch("inbox.json?ts=" + Date.now());
        const data = await res.json();
        renderInbox(data.messages || []);
      } catch {
        list.innerHTML = `<div class="p-4 text-gray-500 text-sm">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åå†è¯•</div>`;
      }
    }

    function renderInbox(messages) {
      list.innerHTML = "";
      if (!messages.length) {
        list.innerHTML = `<div class="p-4 text-gray-500 text-sm">æš‚æ— é‚®ä»¶</div>`;
        return;
      }

      messages.reverse().forEach(msg => {
        const row = document.createElement("div");
        row.className = "grid grid-cols-3 hover:bg-gray-50";
        row.innerHTML = `
          <div class="table-cell">${msg.from || 'æœªçŸ¥'}</div>
          <div class="table-cell">${msg.subject || 'æ— ä¸»é¢˜'}</div>
          <div class="table-cell">${formatTime(msg.date)}</div>
        `;
        list.appendChild(row);
      });
    }

    function startCountdown() {
      countdown--;
      if (countdown <= 0) {
        fetchInbox();
        countdown = 5;
      }
      timerText.textContent = `æ­£åœ¨æ¥æ”¶é‚®ä»¶ä¸­... ${countdown} ç§’åè‡ªåŠ¨åˆ·æ–°`;
    }

    // åˆå§‹åŒ–
    fetchInbox();
    setInterval(startCountdown, 1000);
  </script>
</body>
</html>
